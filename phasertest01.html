<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Firewall Penitentiary</title>
    <script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
    body {
        background-color: darkblue;
        float: left;
        box-sizing: border-box;
    }
    /* This is the element to modify to style the game window */

    canvas {
        border: lightblue 2px solid;
        margin: 10px;
    }

    #mainScreen {
        width: 800px;
        height: 600px;
    }

    #chatWindow {
        background-color: lightblue;
        width: 800;
        height: 100px;
    }
    </style>
</head>

<body>
    <div></div>
    <div id="#mainScreen">
    </div>
    <div id="#chatWindow"></div>
    <script type="text/javascript">
    /* $(document).ready (function () {

                                                                                                                                            });*/

    var game = new Phaser.Game(800, 600, Phaser.AUTO, '#mainScreen', {
        preload: preload,
        create: create,
        update: update
    });

    var player, playerBullets, stars;
    console.log(game);

    function preload() {

        game.load.image('map01', 'assets/map01small.jpg');
        game.load.image('star', 'assets/star.png');
        game.load.image('playerBullet', 'assets/playerBullet.png');
        game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
        game.load.image('shield', 'assets/shield.png');

    }


    function create() {
        /*Create map & terrain features*/
        game.add.sprite(0, 0, 'map01');

        //Adds a group called stars and then randomly adds 10 stars scattered over the map
        stars = game.add.group();
        for (i = 0; i < 10; i++) {
            var xLoc = Math.floor(Math.random() * 790);
            var yLoc = Math.floor(Math.random() * 590);
            stars.create(xLoc, yLoc, 'star');
        };
        //Enable physics for the stars group
        game.physics.arcade.enable(stars);
        //Iterates over each member of the stars group and stops them from leaving map.
        stars.forEachAlive(function(star) {
            star.body.collideWorldBounds = true;
        });

        //Creates a group called playerBullets and randomly adds 10 of them to the map
        playerBullets = game.add.group();
        for (i = 0; i < 10; i++) {
            var xLoc = Math.floor(Math.random() * 790);
            var yLoc = Math.floor(Math.random() * 590);
            playerBullets.create(xLoc, yLoc, 'playerBullet');
        };
        //Enable physics for the playerBullets group
        game.physics.arcade.enable(playerBullets);
        //Iterates over each member of the stars group and stops them from leaving map.
        playerBullets.forEachAlive(function(playerBullet) {
            playerBullet.body.collideWorldBounds = true;
            playerBullet.body.bounce.x = 1;
            playerBullet.body.bounce.y = 1;
            playerBullet.anchor.setTo(0.5, 0.5);
        });
        playerBullets.forEachAlive(function(playerBullet) {
            playerBullet.body.velocity.x = (Math.floor(Math.random() * 200) - 100);
            playerBullet.body.velocity.y = (Math.floor(Math.random() * 200) - 100);
        });

        //loads the player into the map
        spawnPlayer();


    }

    function update() {
        //spin bullets
        playerBullets.forEachAlive(function(playerBullet) {
            playerBullet.angle += 10;
        });


        //Create a collision event - player vs stars
        var starStruck = game.physics.arcade.collide(player, stars);

        //Collision detection for weapons fire
        game.physics.arcade.overlap(player, playerBullets, killPlayer, null, this);

        /*Entity Movement*/
        //Iterates over the stars group and moves them randomly, making them buzz like angry wasps
        stars.forEachAlive(function(star) {
            star.body.velocity.x = (Math.floor(Math.random() * 250) - 125);
            star.body.velocity.y = (Math.floor(Math.random() * 250) - 125);
        });

        //  Reset the players velocity, x and y, so they stop when not pressing movement keys
        player.body.velocity.x = 0;
        player.body.velocity.y = 0;

        //Register cursor keys for player movement
        var cursors = game.input.keyboard.createCursorKeys(),
            //Register the other keys.
            keySPACE = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),
            keyA = game.input.keyboard.addKey(Phaser.Keyboard.A),
            keyS = game.input.keyboard.addKey(Phaser.Keyboard.S),
            keyW = game.input.keyboard.addKey(Phaser.Keyboard.W),
            keyD = game.input.keyboard.addKey(Phaser.Keyboard.D),
            //Register mouse for aiming and firing
            mouse = game.input.mousePointer;

        //Stop the following keys from propagating up to the browser - is this necessary?
        game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);

        /*Movement event handlers. Note: If you don't account for diagonals first, cardinals will override and only move you in one direction, not two.*/

        if (keyW.isDown && keyA.isDown || cursors.up.isDown && cursors.left.isDown) {
            //UP LEFT
            player.body.velocity.x = -150;
            player.body.velocity.y = -150;
            player.animations.play('left');
        } else if (keyW.isDown && keyD.isDown || cursors.up.isDown && cursors.right.isDown) {
            //UP RIGHT
            player.body.velocity.x = 150;
            player.body.velocity.y = -150;
            player.animations.play('right');
        } else if (keyS.isDown && keyA.isDown || cursors.down.isDown && cursors.left.isDown) {
            //DOWN LEFT
            player.body.velocity.x = -150;
            player.body.velocity.y = 150;
            player.animations.play('left');
        } else if (keyS.isDown && keyD.isDown || cursors.down.isDown && cursors.right.isDown) {
            //DOWN RIGHT
            player.body.velocity.x = 150;
            player.body.velocity.y = 150;
            player.animations.play('right');
        } else if (keyW.isDown || cursors.up.isDown) {
            //UP

            /*        game.physics.arcade.accelerationFromRotation(*/
            player.body.velocity.y = -150;
            player.frame = 4;
     /*       playerShield.angle = 0;*/
        } else if (keyS.isDown || cursors.down.isDown) {
            //DOWN
            player.body.velocity.y = 150;
            player.frame = 4;
          /*  playerShield.angle = 180;*/
        } else if (keyA.isDown || cursors.left.isDown) {
            //LEFT
            player.body.velocity.x = -150;
            player.animations.play('left');
          /*  playerShield.angle = -90;*/
        } else if (keyD.isDown || cursors.right.isDown) {
            //RIGHT
            player.body.velocity.x = 150;
            player.animations.play('right');
         /*   playerShield.angle = 90;*/
        } else {
            //Stand still

            player.animations.stop();

            /*  player.frame = 4;*/
        };


        //Checks to see if the spacebar is down
        if (keySPACE.isDown) {
            console.log("Space Key is Down");
        };

        if (mouse.isDown) {
            console.log("Mouse X: " + mouse.x + " Y: " + mouse.y);
        }
    };


    function killPlayer() {
        player.kill();
        setTimeout(respawnPlayer, 5000);
    };

    function spawnPlayer() {
        /*Create player and its settings*/
        player = game.add.sprite(400, 300, 'dude');
        //Enable physics on the player
        game.physics.arcade.enable(player);
        //Stop player and stars from leaving map.
        player.body.collideWorldBounds = true;
        //Our two animations, walking left and right.
        player.animations.add('left', [0, 1, 2, 3], 10, true);
        player.animations.add('right', [5, 6, 7, 8], 10, true);
        player.anchor.setTo(0.5, 0.5);
        console.log(player);
      /*  playerShield = game.add.sprite(player.x + 16, player.y + 24, 'shield');*/
        /*   player.addChild(playerShield);*/
        /* playerShield.x += 50;*/
        /*
                game.physics.arcade.enable(playerShield);*/
        /*playerShield.immovable = true;*/
       /* playerShield.anchor.setTo(0.5, 0.5);*/
    };

    function respawnPlayer() {
        player.revive();
        player.x = 400, player.y = 300;
    }
    </script>
</body>

</html>